{
  "nodes": [
    {
      "code": "/**\n * Exclusive lock implementation to put message\n */\npublic class PutMessageReentrantLock implements PutMessageLock {\n    private ReentrantLock putMessageNormalLock = new ReentrantLock(); // NonfairSync\n\n    @Override\n    public void lock() {\n        putMessageNormalLock.lock();\n    }\n\n    @Override\n    public void unlock() {\n        putMessageNormalLock.unlock();\n    }\n}\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/PutMessageReentrantLock.java",
      "id": 46,
      "desc": "addClassDeclaration",
      "group": 0
    },
    {
      "code": "/**\n * Spin lock Implementation to put message, suggest using this witb low race conditions\n *\n */\npublic class PutMessageSpinLock implements PutMessageLock {\n    //true: Can lock, false : in lock.\n    private AtomicBoolean putMessageSpinLock = new AtomicBoolean(true);\n\n    @Override\n    public void lock() {\n        boolean flag;\n        do {\n            flag = this.putMessageSpinLock.compareAndSet(true, false);\n        }\n        while (!flag);\n    }\n\n    @Override\n    public void unlock() {\n        this.putMessageSpinLock.compareAndSet(false, true);\n    }\n}\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/PutMessageSpinLock.java",
      "id": 47,
      "desc": "addClassDeclaration",
      "group": 1
    },
    {
      "code": "        this.putMessageLock =  defaultMessageStore.getMessageStoreConfig().isUseReentrantLockWhenPutMessage() ? new PutMessageReentrantLock() : new PutMessageSpinLock();\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/CommitLog.java",
      "id": 35,
      "desc": "addExpressionStatement",
      "group": 3
    },
    {
      "code": "        putMessageLock.lock(); //spin or ReentrantLock ,depending on store config\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/CommitLog.java",
      "id": 36,
      "desc": "updateExpressionStatement   by",
      "group": 3
    },
    {
      "code": "        putMessageLock.lock();\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/CommitLog.java",
      "id": 37,
      "desc": "updateExpressionStatement   by",
      "group": 3
    },
    {
      "code": "            putMessageLock.unlock();\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/CommitLog.java",
      "id": 38,
      "desc": "updateExpressionStatement   by",
      "group": 3
    },
    {
      "code": "            putMessageLock.unlock();\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/CommitLog.java",
      "id": 39,
      "desc": "updateExpressionStatement   by",
      "group": 3
    },
    {
      "code": "    private final PutMessageLock putMessageLock;\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/CommitLog.java",
      "id": 40,
      "desc": "addFieldDeclaration",
      "group": 3
    },
    {
      "code": "    private AtomicBoolean putMessageSpinLock = new AtomicBoolean(true);\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/CommitLog.java",
      "id": 41,
      "desc": "deleteFieldDeclaration",
      "group": 3
    },
    {
      "code": "    private ReentrantLock putMessageNormalLock = new ReentrantLock(); // NonfairSync\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/CommitLog.java",
      "id": 42,
      "desc": "deleteFieldDeclaration",
      "group": 3
    },
    {
      "code": "    private void lockForPutMessage() {\n        if (this.defaultMessageStore.getMessageStoreConfig().isUseReentrantLockWhenPutMessage()) {\n            putMessageNormalLock.lock();\n        } else {\n            boolean flag;\n            do {\n                flag = this.putMessageSpinLock.compareAndSet(true, false);\n            }\n            while (!flag);\n        }\n    }\n\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/CommitLog.java",
      "id": 43,
      "desc": "deleteMethodDeclaration",
      "group": 3
    },
    {
      "code": "    private void releasePutMessageLock() {\n        if (this.defaultMessageStore.getMessageStoreConfig().isUseReentrantLockWhenPutMessage()) {\n            putMessageNormalLock.unlock();\n        } else {\n            this.putMessageSpinLock.compareAndSet(false, true);\n        }\n    }\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/CommitLog.java",
      "id": 44,
      "desc": "deleteMethodDeclaration",
      "group": 3
    },
    {
      "code": "/**\n * Used when trying to put message\n */\npublic interface PutMessageLock {\n    void lock();\n    void unlock();\n}\n",
      "file_name": "0adad6f0025483647e760c1145f7736462c0ec79__CLDIFF__store/src/main/java/org/apache/rocketmq/store/PutMessageLock.java",
      "id": 45,
      "desc": "addInterface",
      "group": 4
    }
  ],
  "edges": [
    {
      "link_type_str": "def-use@field",
      "source": 37,
      "text": "def-use@field",
      "type": 57,
      "value": 1,
      "target": 40
    },
    {
      "link_type_str": "def-use@field",
      "source": 39,
      "text": "def-use@field",
      "type": 57,
      "value": 1,
      "target": 40
    },
    {
      "link_type_str": "def-use@field",
      "source": 36,
      "text": "def-use@field",
      "type": 57,
      "value": 1,
      "target": 40
    },
    {
      "link_type_str": "def-use@field",
      "source": 38,
      "text": "def-use@field",
      "type": 57,
      "value": 1,
      "target": 40
    },
    {
      "link_type_str": "def-use@field",
      "source": 35,
      "text": "def-use@field",
      "type": 57,
      "value": 1,
      "target": 40
    },
    {
      "link_type_str": "def-use@class",
      "source": 37,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 46
    },
    {
      "link_type_str": "def-use@class",
      "source": 39,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 46
    },
    {
      "link_type_str": "def-use@class",
      "source": 36,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 46
    },
    {
      "link_type_str": "def-use@class",
      "source": 38,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 46
    },
    {
      "link_type_str": "def-use@class",
      "source": 35,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 46
    },
    {
      "link_type_str": "def-use@taicu",
      "source": 46,
      "text": "def-use@taicu",
      "type": 51,
      "value": 1,
      "target": 43
    },
    {
      "link_type_str": "def-use@taicu",
      "source": 46,
      "text": "def-use@taicu",
      "type": 51,
      "value": 1,
      "target": 44
    },
    {
      "link_type_str": "def-use@class",
      "source": 37,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 47
    },
    {
      "link_type_str": "def-use@class",
      "source": 39,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 47
    },
    {
      "link_type_str": "def-use@class",
      "source": 36,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 47
    },
    {
      "link_type_str": "def-use@class",
      "source": 38,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 47
    },
    {
      "link_type_str": "def-use@class",
      "source": 35,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 47
    },
    {
      "link_type_str": "def-use@taicu",
      "source": 47,
      "text": "def-use@taicu",
      "type": 51,
      "value": 1,
      "target": 43
    },
    {
      "link_type_str": "def-use@taicu",
      "source": 47,
      "text": "def-use@taicu",
      "type": 51,
      "value": 1,
      "target": 43
    },
    {
      "link_type_str": "def-use@taicu",
      "source": 47,
      "text": "def-use@taicu",
      "type": 51,
      "value": 1,
      "target": 44
    },
    {
      "link_type_str": "def-use@class",
      "source": 37,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 45
    },
    {
      "link_type_str": "def-use@class",
      "source": 39,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 45
    },
    {
      "link_type_str": "def-use@class",
      "source": 36,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 45
    },
    {
      "link_type_str": "def-use@class",
      "source": 38,
      "text": "def-use@class",
      "type": 55,
      "value": 1,
      "target": 45
    },
    {
      "link_type_str": "def-use@taicu",
      "source": 45,
      "text": "def-use@taicu",
      "type": 51,
      "value": 1,
      "target": 43
    },
    {
      "link_type_str": "def-use@taicu",
      "source": 45,
      "text": "def-use@taicu",
      "type": 51,
      "value": 1,
      "target": 44
    },
    {
      "link_type_str": "systematic",
      "source": 36,
      "text": "systematic",
      "type": 44,
      "value": 1,
      "target": 37
    },
    {
      "link_type_str": "systematic",
      "source": 36,
      "text": "systematic",
      "type": 44,
      "value": 1,
      "target": 38
    },
    {
      "link_type_str": "systematic",
      "source": 36,
      "text": "systematic",
      "type": 44,
      "value": 1,
      "target": 39
    },
    {
      "link_type_str": "systematic",
      "source": 37,
      "text": "systematic",
      "type": 44,
      "value": 1,
      "target": 38
    },
    {
      "link_type_str": "systematic",
      "source": 37,
      "text": "systematic",
      "type": 44,
      "value": 1,
      "target": 39
    },
    {
      "link_type_str": "systematic",
      "source": 38,
      "text": "systematic",
      "type": 44,
      "value": 1,
      "target": 39
    }
  ]
}